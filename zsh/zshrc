# -------------------------------------
# 環境変数
# -------------------------------------
export LANG=ja_JP.UTF-8
export EDITOR=vim
export PATH="$HOME/.local/bin:/opt/homebrew/bin:$PATH"

# ls 時の色を設定する
export CLICOLOR=true
export LSCOLORS='exfxcxdxbxGxDxabagacad'
export LS_COLORS='di=34:ln=35:so=32:pi=33:ex=31:bd=36;01:cd=33;01:su=31;40;07:sg=36;40;07:tw=32;40;07:ow=33;40;07:'

# disable CLAUDE_CODE_TIPS 
export DISABLE_NON_ESSENTIAL_MODEL_CALLS=1

# -------------------------------------
# zplug
# -------------------------------------
export ZPLUG_HOME=/opt/homebrew/opt/zplug
source $ZPLUG_HOME/init.zsh

zplug 'zsh-users/zsh-completions', use:'src/_*', lazy:true
zplug "mafredri/zsh-async", on:sindresorhus/pure
zplug "sindresorhus/pure", use:pure.zsh
zplug "zsh-users/zsh-syntax-highlighting"
zplug "mollifier/cd-gitroot"

if ! zplug check --verbose; then
  printf 'Install? [y/N]: '
  if read -q; then
    echo; zplug install
  fi
fi

zplug load

# -------------------------------------
# zshオプション
# -------------------------------------
autoload -Uz compinit && compinit -u

setopt auto_list
setopt auto_menu
setopt print_eight_bit
setopt no_beep
setopt no_hist_beep
setopt no_list_beep
setopt notify
setopt interactive_comments

# ヒストリ
HISTFILE=~/.zsh_history
HISTSIZE=1000000
SAVEHIST=1000000
setopt share_history
setopt hist_ignore_dups
setopt hist_ignore_all_dups
setopt hist_ignore_space
setopt hist_reduce_blanks

# -------------------------------------
# 補完
# -------------------------------------
zstyle ':completion:*' completer _complete _match _approximate
zstyle ':completion:*' group-name ''
zstyle ':completion:*' list-colors ${(s.:.)LS_COLORS}
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'
zstyle ':completion:*' use-cache true
zstyle ':completion:*' verbose yes
zstyle ':completion:*:default' menu select=2
zstyle ':completion:*:descriptions' format '%F{yellow}-- %d --%f'
zstyle ':completion:*:options' description 'yes'

# -------------------------------------
# パス
# -------------------------------------
typeset -U path cdpath fpath manpath

path=(
    $HOME/bin(N-/)
    $path
)

# -------------------------------------
# Go
# -------------------------------------
if [ -x "`which go`" ]; then
    export GOPATH=$HOME/.go
    export PATH=$PATH:$GOPATH/bin
fi

# -------------------------------------
# peco
# -------------------------------------
export _ENHANCD_FILTER=peco

function peco_select_history() {
    local tac
    if which tac > /dev/null; then
        tac="tac"
    else
        tac="tail -r"
    fi
    BUFFER=$(\history -n 1 | \
        eval $tac | \
        peco --query "$LBUFFER")
    CURSOR=$#BUFFER
    zle clear-screen
}
zle -N peco_select_history

function peco_src() {
    # ghq listにkagemushaを追加（iCloud上のObsidian vault）
    local src_dir=$( (ghq list --full-path; echo "$HOME/Library/Mobile Documents/iCloud~md~obsidian/Documents/kagemusha") | peco --query "$LBUFFER")
    if [ -n "$src_dir" ]; then
        BUFFER="cd \"$src_dir\""
        zle accept-line
    fi
    zle -R -c
}
zle -N peco_src

function ccc() {
    local src_dir=$( (ghq list --full-path; echo "$HOME/Library/Mobile Documents/iCloud~md~obsidian/Documents/kagemusha") | peco --query "$LBUFFER")
    if [ -n "$src_dir" ]; then
        cd "$src_dir" && claude --dangerously-skip-permissions
    fi
}

# -------------------------------------
# キーバインド
# -------------------------------------
bindkey -e
bindkey '^r' peco_select_history
bindkey '^]' peco_src

# -------------------------------------
# エイリアス
# -------------------------------------
alias ll="ls -la"
alias la="ls -la"
alias g="git"
alias cdg="cd-gitroot"
alias z="source ~/.zshrc"
alias cr="cursor"
alias -g C='| pbcopy'
alias y='yazi'
alias cc='claude --dangerously-skip-permissions'
alias ccr='claude -r --dangerously-skip-permissions'

function chpwd() { ls }

# -------------------------------------
# ツール
# -------------------------------------
. /opt/homebrew/opt/asdf/libexec/asdf.sh

# Antigravity
export PATH="$HOME/.antigravity/antigravity/bin:$PATH"

# bun
[ -s "$HOME/.bun/_bun" ] && source "$HOME/.bun/_bun"
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"
[ -s "/Users/tsubasa/.bun/_bun" ] && source "/Users/tsubasa/.bun/_bun"

alias claude-mem='bun "/Users/tsubasa/.claude/plugins/marketplaces/thedotmack/plugin/scripts/worker-service.cjs"'

# ローカル設定
[ -f ~/.zshrc.local ] && source ~/.zshrc.local

